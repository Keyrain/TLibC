PROJECT(TLibC)

set(GEN_PATH ${TLibC_BINARY_DIR}/gen)
set(RE2C_HEADER ${GEN_PATH}/tlibc_xml_reader_l.h)
set(RE2C_OUTPUTS ${GEN_PATH}/tlibc_xml_reader_l.c)


FILE(GLOB_RECURSE LIB_FILE_LIST ${INCLUDE}/lib/*.h ${SOURCE}/lib/*.c)
source_group("lib" FILES ${LIB_FILE_LIST})

FILE(GLOB_RECURSE PROTOCOL_FILE_LIST ${INCLUDE}/protocol/*.h ${SOURCE}/protocol/*.c)
source_group("protocol" FILES ${PROTOCOL_FILE_LIST} ${RE2C_HEADER} ${RE2C_OUTPUTS})


FILE(GLOB_RECURSE RE2C_FILE *.re)

add_custom_command(OUTPUT ${RE2C_HEADER} ${RE2C_OUTPUTS}
	COMMAND re2c -c -F -t${RE2C_HEADER} -o${RE2C_OUTPUTS} ${RE2C_FILE}
)

INCLUDE_DIRECTORIES(
	${INCLUDE}
	${GEN_PATH}
	)

ADD_LIBRARY(TLibC ${PROTOCOL_FILE_LIST} ${LIB_FILE_LIST} ${RE2C_HEADER} ${RE2C_OUTPUTS} ${RE2C_FILE})
SET_TARGET_PROPERTIES(TLibC PROPERTIES OUTPUT_NAME tlibc)

INSTALL(TARGETS TLibC ARCHIVE DESTINATION ${LIBRARY_PATH})
